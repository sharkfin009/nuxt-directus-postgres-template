import{useApi as e,defineModule as t}from"@directus/extensions-sdk";import{ref as l,onMounted as a,resolveComponent as n,openBlock as i,createBlock as u,withCtx as o,createVNode as s,createTextVNode as r,createElementBlock as c,Fragment as m,renderList as d,toDisplayString as p,createElementVNode as v,createCommentVNode as f,withDirectives as y,vShow as b}from"vue";var g=[],_=[];!function(e,t){if(e&&"undefined"!=typeof document){var l,a=!0===t.prepend?"prepend":"append",n=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(n){var u=g.indexOf(i);-1===u&&(u=g.push(i)-1,_[u]={}),l=_[u]&&_[u][a]?_[u][a]:_[u][a]=o()}else l=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),l.styleSheet?l.styleSheet.cssText+=e:l.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var l=Object.keys(t.attributes),n=0;n<l.length;n++)e.setAttribute(l[n],t.attributes[l[n]]);var u="prepend"===a?"afterbegin":"beforeend";return i.insertAdjacentElement(u,e),e}}("\n.hp {\n  /* --v-sheet-padding: 50px; */\n  padding-left: 50px !important;\n  padding-right: 50px !important;\n}\n.w-100 {\n  width: 100%;\n}\n.w-25 {\n  width: 25% !important;\n}\n.v-table {\n  /* pointer-events: none; */\n  margin-top: 30px;\n}\n.mb {\n  margin-bottom: 30px !important;\n}\n.mt {\n  margin-top: 10px !important;\n}\n.fl-right {\n  float: right;\n}\n.enquiryItem {\n  cursor: pointer;\n}\n.enquiryItem:hover {\n  color: green;\n}\n.flex {\n  display: flexbox !important;\n}\n.center {\n  text-align: center !important;\n}\n.iconColor {\n  color: green;\n}\n",{});var h=(e,t)=>{const l=e.__vccOpts||e;for(const[e,a]of t)l[e]=a;return l};const x=["onClick"],q={width:"15"},k={class:"mb"},C={style:{"text-align":"center","font-size":"20px",color:"green"},class:"mb"},w=v("h4",{class:"mb"},"My comments on this enquiry:",-1),E={class:"form"},U=v("h4",{class:"mb"},"Enquiry Status:",-1),V=v("h4",{style:{"padding-top":"30px"},class:"mb"},"Completed:",-1),S={style:{width:"100%",height:"50px",display:"flex","justify-content":"center"}},I=v("h1",{style:{"font-size":"20px",color:"green","text-align":"center"},class:"mb text-center w-full"}," ENQUIRY DETAILS ",-1),N={class:"w-100 mb"},A={class:"w-25"},T={__name:"module",setup(t){const g=e(),_=l({}),h=l({}),T=l({}),$=l({}),j=l(!1),O=()=>{j.value=!0},P=async()=>{g.patch(`./items/${T.value.collection}/${T.value.id}`,{consultant_comments:T.value.consultant_comments,completed:T.value.completed,enquiry_status:T.value.enquiry_status}).then((e=>{j.value=!1}))},R=e=>e.replace(/^_*(.)|_+(.)/g,((e,t,l)=>t?t.toUpperCase():" "+l.toUpperCase()));a((async()=>{await g.get("users/me").then((e=>{$.value=e.data.data})),"a1f3596d-9627-4257-890d-07aa217083e5"==$.value.role?await g.get(`/items/customers?filter[consultant][_eq]=${$.value.id}&fields=*`).then((e=>{_.value=e.data.data})):await g.get("/items/customers?fields=*").then((e=>{_.value=e.data.data}));let e=[{label:"General Enquiry",collection:"enquiries"},{label:"Package Enquiry",collection:"package_enquiries"},{label:"Group Enquiry",collection:"group_enquiries"},{label:"Flight Special Enquiry",collection:"flight_special_enquiries"},{label:"Contact Us Enquiry",collection:"contact_enquiries"}];for(let t of _.value){let l=[];for(let a of e){let e=await z(a,t.email);e&&(l.push(e),t.enquiries=l.flat()??[],T.value=l.flat()[0]??[])}}}));const z=async(e,t)=>{let l=(await g.get(`/items/${e.collection}?filter[customer][_eq]=${t}`)).data.data;if(l.length)return l=l.map((t=>({label:e.label,collection:e.collection,...t}))),l};return(e,t)=>{const l=n("v-card-title"),a=n("v-list-item"),g=n("v-icon"),z=n("v-list"),G=n("v-table"),Q=n("v-textarea"),Y=n("v-select"),B=n("v-checkbox"),D=n("v-button"),F=n("v-sheet"),K=n("transition-expand"),L=n("v-transition"),M=n("private-view");return i(),u(M,{title:"Enquiries Portal: "+$.value.first_name+" "+$.value.last_name},{navigation:o((()=>[s(l,{style:{"text-align":"center"}},{default:o((()=>[r(" Customers: ")])),_:1}),s(z,null,{default:o((()=>[(i(!0),c(m,null,d(_.value,((e,t)=>(i(),u(a,{key:t},{default:o((()=>[s(z,null,{default:o((()=>[r(p(e.full_name)+" ",1),v("table",null,[(i(!0),c(m,null,d(e.enquiries,((t,l)=>(i(),c("tr",{key:l,onClick:t=>(async(e,t)=>{h.value=await _.value.find((t=>t.email==e)),T.value=await h.value.enquiries[t],console.log("selected enquiry: ",T.value),j.value=!1})(e.email,l)},[v("td",null,[s(a,{class:"enquiryItem"},{default:o((()=>[r(p(l+1+" "+t.label+" "),1)])),_:2},1024)]),v("td",q,[h.value.email==e.email&&T.value.id==t.id?(i(),u(g,{key:0,name:"check","x-small":""})):f("v-if",!0)])],8,x)))),128))])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),default:o((()=>[v("div",k,[s(K,null,{default:o((()=>[T.value!=={}?(i(),u(F,{key:0,class:"hp"},{default:o((()=>{return[s(G,{class:"mb",headers:[{text:"Customer Name",value:"name"},{text:"Phone Number",value:"cell_number"},{text:"Email",value:"email"}],items:[{name:h.value.full_name,cell_number:h.value.cell_number,email:h.value.email}]},null,8,["items"]),v("h1",C,p(T.value.label?T.value.label.toUpperCase():"ENQUIRY"),1),w,v("form",E,[s(Q,{class:"mb",onKeyup:O,modelValue:T.value.consultant_comments,"onUpdate:modelValue":t[0]||(t[0]=e=>T.value.consultant_comments=e)},null,8,["modelValue"]),U,s(Y,{style:{"margin-bottom":"30px"},block:"true",modelValue:T.value.status,"onUpdate:modelValue":t[1]||(t[1]=e=>T.value.status=e),class:"mb",onClick:O,items:[{text:"Current",value:"current"},{text:"Unresolved",value:"unresolved"},{text:"Resolved",value:"resolved"}]},null,8,["modelValue"]),V,s(B,{class:"mb",modelValue:T.value.completed,"onUpdate:modelValue":t[2]||(t[2]=e=>T.value.completed=e),label:"Completed",block:"true",onClick:O},null,8,["modelValue"]),v("div",S,[y(s(D,{onClick:P,class:"mt-5"},{default:o((()=>[r("Save Changes")])),_:1},512),[[b,j.value]])])]),v("div",null,[I,v("table",N,[(i(!0),c(m,null,d((e=T.value,Object.entries(e).filter((e=>!["id","status","sort","enquiry","completed","consultant_comments","enquiry_status","package_enquiry","group_enquiry","flight_special_enquiry"].includes(e[0]))).map((e=>({property:R(e[0]),value:e[1]})))),((e,t)=>(i(),c("tr",{key:t},[v("td",A,p(e.property),1),v("td",null,p(e.value),1)])))),128))])])];var e})),_:1})):f("v-if",!0)])),_:1}),T.value==={}?(i(),u(L,{key:0},{default:o((()=>[s(F,{class:"hp"},{default:o((()=>[r(" loading... ")])),_:1})])),_:1})):f("v-if",!0)])])),_:1},8,["title"])}}};var $=t({id:"enquiries_portal",name:"Enquiries Portal",icon:"demography",routes:[{path:"",component:h(T,[["__file","module.vue"]])}]});export{$ as default};
