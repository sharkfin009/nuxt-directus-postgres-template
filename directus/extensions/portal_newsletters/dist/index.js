import{useApi as e,defineModule as t}from"@directus/extensions-sdk";import{ref as n,resolveComponent as l,openBlock as s,createBlock as i,withCtx as a,createVNode as r,createTextVNode as o,toDisplayString as u,createElementVNode as c,withDirectives as d,vModelText as p,createCommentVNode as v,createElementBlock as f,reactive as m,onMounted as g,Fragment as b,renderList as y}from"vue";var h=(e,t)=>{const n=e.__vccOpts||e;for(const[e,l]of t)n[e]=l;return n};const x=c("br",null,null,-1),w=c("br",null,null,-1),_=c("br",null,null,-1),k=c("br",null,null,-1),N={key:2,class:"w-100 flex",style:{"padding-left":"200px","padding-right":"200px","padding-top":"50px","padding-bottom":"50px"}},S={__name:"send",props:{title:{type:String},status:{type:String},id:{type:Number},subscribers:{type:Array}},setup(t){let m=t;const g=e(),b=async()=>{h.value=!0},y=n(""),h=n(!1),S=n("not sent");n(!0);const C=async e=>(console.log("sending email"),g.post("./newsletter_send/send",{html:y.value,title:m.title,testMode:e,subscribers:m.subscribers}).then((e=>{200==e.status?(console.log("response from endpoint",JSON.stringify(e)),h.value=!0,A()):console.log("error from endpoint",JSON.stringify(e))})),"done"),A=async()=>(g.patch(`./items/newsletters/${m.id}`,{status:"sent"}).then((e=>{200==e.status?(console.log("response from API",JSON.stringify(e)),S.value="sent"):console.log("error from API",JSON.stringify(e))})),"done");return(e,n)=>{const m=l("v-card-title"),g=l("v-button"),A=l("v-icon"),O=l("v-sheet");return s(),i(O,{class:"hp"},{default:a((()=>[r(m,null,{default:a((()=>[o("Newsletter title: "+u(t.title),1)])),_:1}),c("div",null,[o(" paste html here "),d(c("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>y.value=e),class:"w-100",type:"textarea"},null,512),[[p,y.value]])]),x,w,r(g,{onClick:n[1]||(n[1]=e=>C(!0))},{default:a((()=>[o("Send Test")])),_:1}),"sent"!==S.value&&!1===h.value?(s(),i(g,{key:0,onClick:b,class:"fl-right"},{default:a((()=>[o("Send Newsletter")])),_:1})):v("v-if",!0),"sent"!==S.value&&!0===h.value?(s(),i(g,{key:1,onClick:n[2]||(n[2]=e=>C(!1)),class:"fl-right"},{default:a((()=>[o("Click to confirm")])),_:1})):v("v-if",!0),_,k,"sent"===S.value?(s(),f("div",N,[o(" Success "),r(A,{class:"iconColor fl-right",name:"check",size:"xl"})])):v("v-if",!0)])),_:1})}}};var C=h(S,[["__file","send.vue"]]),A=[],O=[];!function(e,t){if(e&&"undefined"!=typeof document){var n,l=!0===t.prepend?"prepend":"append",s=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(s){var a=A.indexOf(i);-1===a&&(a=A.push(i)-1,O[a]={}),n=O[a]&&O[a][l]?O[a][l]:O[a][l]=r()}else n=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),n.styleSheet?n.styleSheet.cssText+=e:n.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var n=Object.keys(t.attributes),s=0;s<n.length;s++)e.setAttribute(n[s],t.attributes[n[s]]);var a="prepend"===l?"afterbegin":"beforeend";return i.insertAdjacentElement(a,e),e}}("\n.hp {\n  /* --v-sheet-padding: 50px; */\n  padding-left: 50px !important;\n  padding-right: 50px !important;\n}\n.w-100 {\n  width: 100%;\n}\n.w-25 {\n  width: 25% !important;\n}\n.v-table {\n  /* pointer-events: none; */\n  margin-top: 30px;\n}\n.mb {\n  margin-bottom: 30px !important;\n}\n.mt {\n  margin-top: 10px !important;\n}\n.fl-right {\n  float: right;\n}\n.cp {\n  cursor: pointer;\n}\n.enquiryItem:hover {\n  color: green;\n}\n.flex {\n  display: flexbox !important;\n}\n.between {\n  justify-content: space-between !important;\n}\n.center {\n  text-align: center !important;\n}\n.iconColor {\n  color: green;\n}\n",{});const T={class:"cp w-100"},J={class:"fl-right"},P={class:"mb"},j={__name:"module",setup(t){let d=e();const p=n([]),h=m({}),x=n(!1),w=n([]);return g((async()=>{await d.get("/items/newsletters?fields=*").then((e=>{p.value=e.data.data})),await d.get("/items/subscribers?fields=email&limit=10000").then((e=>{w.value=e.data.data}))})),(e,t)=>{const n=l("v-card-title"),d=l("v-list-item"),m=l("v-list"),g=l("private-view");return s(),i(g,{title:"Newsletter Portal: "},{navigation:a((()=>[r(n,{style:{"text-align":"center"}},{default:a((()=>[o(" Newsletters ")])),_:1}),r(m,{class:"w-100"},{default:a((()=>[(s(!0),f(b,null,y(p.value,((e,t)=>(s(),i(d,{value:2,block:!0,clickable:!0,grow:!0,exact:!0,query:!1,nav:!1,class:"",key:t,style:{"margin-left":"30px","margin-right":"30px"},onClick:t=>(async e=>{console.log("selected newsletter id: ",e),h.value=p.value.find((t=>t.id==e)),console.log("selected newsletter: ",h),x.value=!0})(e.id)},{default:a((()=>[c("div",T,[c("div",null,u(e.title),1),c("div",J,"status: "+u(e.status),1)])])),_:2},1032,["onClick"])))),128))])),_:1})])),default:a((()=>[c("div",P,[x.value?(s(),i(C,{title:h.value.title,id:h.value.id,status:h.value.status,subscribers:w.value,key:h.value.id},null,8,["title","id","status","subscribers"])):v("v-if",!0)])])),_:1})}}};var q=t({id:"newsletter_portal",name:"Newsletter Portal",icon:"send",routes:[{path:"",component:h(j,[["__file","module.vue"]])}]});export{q as default};
